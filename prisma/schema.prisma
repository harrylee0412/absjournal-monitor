generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

// Journal table (globally shared)
model Journal {
  id         Int       @id @default(autoincrement())
  title      String
  printIssn  String?
  eIssn      String?
  ajgRanking String?
  domain     String?   // ABS field/domain (e.g., "Entrepreneurship and Small Business Management")
  isFt50     Boolean   @default(false)
  isUtd24    Boolean   @default(false)
  isCustom   Boolean   @default(false)  // User-added custom journal
  articles   Article[]
  followers  UserJournalFollow[]
}

// Article table (globally shared)
model Article {
  id              Int           @id @default(autoincrement())
  doi             String        @unique
  title           String
  authors         String?
  abstract        String?
  publicationDate DateTime?
  url             String?
  journalId       Int
  createdAt       DateTime      @default(now())
  
  journal         Journal       @relation(fields: [journalId], references: [id])
  userArticles    UserArticle[]
}

// User journal follows (per-user)
model UserJournalFollow {
  id        Int      @id @default(autoincrement())
  userId    String   // 来自 neon_auth.users
  journalId Int
  createdAt DateTime @default(now())
  
  journal   Journal  @relation(fields: [journalId], references: [id])
  
  @@unique([userId, journalId])
  @@index([userId])
}

// User article read status (per-user)
model UserArticle {
  id        Int      @id @default(autoincrement())
  userId    String
  articleId Int
  isRead    Boolean  @default(false)
  createdAt DateTime @default(now())
  
  article   Article  @relation(fields: [articleId], references: [id])
  
  @@unique([userId, articleId])
  @@index([userId])
}

// User settings (per-user)
model UserSettings {
  id            Int       @id @default(autoincrement())
  userId        String    @unique
  emailEnabled  Boolean   @default(false)
  targetEmail   String?
  smtpConfig    String?   // JSON: {host, port, auth: {user, pass}, from}
  cronApiKey    String?   // For legacy cron-job.org authentication
  zoteroUserId  String?   // Zotero numeric User ID (from zotero.org/settings/keys)
  zoteroApiKey  String?   // Zotero API Key (needs read/write permissions)
  lastCheckTime DateTime?
  lastProcessedJournalIndex Int @default(0)  // For batch processing
  preferredHour Int       @default(0)        // 0-23, hour of day for updates (UTC)
  createdAt     DateTime  @default(now())
  
  @@index([userId])
  @@index([preferredHour])
}

